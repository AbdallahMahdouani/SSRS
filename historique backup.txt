$sqlservers ="DESKTOP-95KKMMH","DESKTOP-95KKMMH\production"
$serveur="DESKTOP-95KKMMH"
$database="msdb"
foreach($sqlserver in $sqlservers)
{
$all_history=Get-DbaDbBackupHistory -SqlInstance $sqlserver
#$all_history | Select-Object -Property SqlInstance , Database,Type,TotalSize,DeviceType,Start,Duration,End #|
#Write-SqlTableData -DatabaseName msdb -TableName History_backup -ServerInstance "DESKTOP-95KKMMH" -SchemaName "dbo"
foreach($history in $all_history)
{$instnace_name=$history.SqlInstance
$databasename=$history.Database
$Type=$history.type
$TotalSize=$history.TotalSize
$DeviceType=$history.DeviceType
$start=$history.Start
$Duration=$history.duration
$END=$history.END
$insertReq =[String]::format(
                                      "insert into msdb.dbo.History_backup
                                              ( 
                                               [SqlInstance]  
	                                          ,[databasename] 
	                                          ,[type] 
	                                          ,[Total_size]  
	                                          ,[devicetype]  
	                                          ,[start]  
	                                          ,[duration]  
	                                          ,[end_backup] 
                                               )
                                              
                                              values
                                           ('$instnace_name','$databasename','$Type','$TotalSize','$DeviceType','$start','$Duration','$END')
                                           ")
Invoke-Sqlcmd -ErrorAction 'Stop' -ServerInstance $serveur -Database $database -query $insertReq
}
}


 #|

#$history 
# TotalSize,DeviceType,Start,Duration,End|
#